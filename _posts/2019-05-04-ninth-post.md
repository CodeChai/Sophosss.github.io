---
title: 数据库小知识
author: Sophosss
layout: post
---
1. 数据库索引，B+树和HASH中为什么用B+树？
   - hash表只能匹配是否相等，不能实现范围查找
   - 当需要按照索引进行order by时，hash值没办法支持排序
   - B+树组合索引可以支持部分索引查询
   - 当数据量很大时，hash冲突的概率也会非常大
   - B+树作为索引时，非叶子节点只保存索引，叶子节点才会保存数据，这样方便扫库，只需要扫一遍叶子结点即可，但是B树因为其分支结点同样存储着数据，我们要找到具体的数据，需要进行一次中序遍历按序来扫，所以B+树更加适合在区间查询的情况

2. 聚簇索引和非聚簇索引的区别？

   聚簇索引的叶子节点就是数据节点，而非聚簇索引的叶子节点仍然是索引节点，只不过有指向对应数据块的指针。

   聚簇索引是物理地址连续存放的索引，在取区间的时候，查找速度非常快。

3. 内连接，外（左右）链接，全连接的区别？
   - left join （左连接）：返回包括左表中的所有记录和右表中连接字段相等的记录。
   - right join （右连接）：返回包括右表中的所有记录和左表中连接字段相等的记录。
   - inner join （等值连接或者叫内连接）：只返回两个表中连接字段相等的行。
   - full join （全外连接）：返回左右表中所有的记录和左右表中连接字段相等的记录。

4. join on 后and条件和where后加and条件区别？

   - left join 不管 on 上的条件是否为真都会返回 left 或 right 表中的记录。

   - on是在生成连接表的起作用的，where是生成连接表之后对连接表再进行过滤。
   - 使用inner join时，功能与where完全相同。

5. B+树的特点？

   - 关键字数和子树相同。

   - 非叶子节点仅用作索引，不含数据信息。它的关键字和子节点有重复元素。

   - 叶子节点用指针连在一起，构成有序链表。

6. 数据库隔离级别及实现原理？

   - 读未提交

     - 事务对当前被读取的数据不加锁；

     - 事务在更新某数据的瞬间（就是发生更新的瞬间），必须先对其加 **行级共享锁**，直到事务结束才释放。

   - 读提交

     - 事务对当前被读取的数据加 **行级共享锁（当读到时才加锁）**，一旦读完该行，立即释放该行级共享锁；
     - 事务在更新某数据的瞬间（就是发生更新的瞬间），必须先对其加 **行级排他锁**，直到事务结束才释放。

   - 可重复读

     - 事务在读取某数据的瞬间（就是开始读取的瞬间），必须先对其加 **行级共享锁**，直到事务结束才释放；
     - 事务在更新某数据的瞬间（就是发生更新的瞬间），必须先对其加 **行级排他锁**，直到事务结束才释放。

   - 串行化

     - 事务在读取数据时，必须先对其加 **表级共享锁** ，直到事务结束才释放；
     - 事务在更新数据时，必须先对其加 **表级排他锁** ，直到事务结束才释放。

7. 索引的数据结构？

   hash结构，二叉搜索树，红黑树，B树（文件索引），B+树（数据库索引）。

8. 数据库索引为什么要用b+树不用红黑树？

   操作系统读写磁盘的基本单位是扇区，而文件系统的基本单位是簇，磁盘读写有一个最少内容的限制。由于 B+ 树分支比二叉树更多，所以相同数量的内容，B+ 树的深度更浅，代表更少的 IO 次数。

   数据库设计的时候 B+ 树有多少个分支都是按照磁盘一个簇上最多能放多少节点设计。