---
title: Java小知识(1)
author: Sophosss
layout: post
---
1. 为什么1.8后永久代中的字符串常量池移到了堆中，然后消除了永久代？

   永久代很容易发生内存泄漏，为了不会遇到永久代存在的内存溢出错误，也不会出现泄漏的数据移到交换区这样的事情。用户可以为元空间设置一个可用空间最大值，如果不进行设置，JVM会自动根据类的元数据大小动态增加元空间的容量。  

2. 方法区的垃圾回收？永久代会垃圾回收吗？
   - 废弃常量：如果一个字符串"abc"已经进入常量池，但是当前系统没有任何一个String对象引用了叫做"abc"的字面量，那么如果发生垃圾回收并且有必要时，"abc"就会被系统移出常量池。
   - 无用的类：该类的所有实例都已经被回收，即Java堆中不存在该类的任何实例；加载该类的ClassLoader已经被回收；该类对应的java.lang.class对象没有在任何地方被引用，无法在任何地方通过反射访问该类的方法。

3. 进程间通信机制有哪些？（进程间通信有哪几种方式？）
   - 管道：管道是一种半双工的通信方式，数据只能单向流动，而且只能在具有亲缘关系的进程间使用。进程的亲缘关系通常是指父子进程关系。
   - 信号量：信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。
   - 消息队列：消息队列是由消息的链表，存放在内核中并由消息队列标识符标识。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点。
   - 信号 ：信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。
   - 共享内存：共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是最快的 IPC  方式，它是针对其他进程间通信方式运行效率低而专门设计的。它往往与其他通信机制，如信号量，配合使用，来实现进程间的同步和通信。
   - 套接字：套解字也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同及其间的进程通信。

4. 访问一个网站，发生了什么？
   - 输入www.google.com，DNS协议帮助我们将这个网址转换成IP地址。已知DNS服务器为8.8.8.8，于是我们向这个地址发送一个DNS数据包（53端口）。DNS服务器做出响应，告诉我们它的IP地址是172.194.72.105。
   - 已知子网掩码是255.255.255.0，本机用它对自己的IP地址192.168.1.100，做一个二进制的AND运算，结果为192.168.1.0。然后对Google的IP地址172.194.72.105也做一个AND运算，计算结果为172.194.72.0。这两个结果不相等，所以结论是，Google与本机不在同一个子网络。因此，我们要向Google发送数据包，必须通过网关192.168.1.1转发。
   - TCP数据包需要设置端口，接收方（Google）的HTTP端口默认是80，发送方（本机）的端口是一个随机生成的1024-65535之间的整数，假定为51775。
   - TCP数据包嵌入IP数据包，IP数据包需要设置双方的IP地址，这是已知的，发送方是192.168.1.100（本机），接收方是172.194.72.105（Google）。
   - IP数据包嵌入以太网数据包，以太网数据包需要设置双方的MAC地址，发送方为本机的网卡MAC地址，接收方为网关192.168.1.1的MAC地址（通过ARP协议得到）。
   - 经过多个网关的转发，Google的服务器172.194.72.105，收到了这所有以太网数据包。根据IP标头的序号，Google将所有包拼起来，取出完整的TCP数据包，然后读出里面的"HTTP请求"，接着做出"HTTP响应"，再用TCP协议发回来。
   - 本机收到HTTP响应以后，就可以将网页显示出来，完成一次网络通信。